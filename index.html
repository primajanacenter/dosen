<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Primajana â€“ Career OS untuk Dosen Indonesia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-xl mx-auto p-6 mt-10 bg-white rounded-xl shadow"
     x-data="careerApp()">

  <h1 class="text-2xl font-bold mb-1">Primajana</h1>
  <p class="mb-6 text-gray-600">
    Masukkan ORCID atau nama Anda. Semua data diambil dari sumber publik.
  </p>

  <input x-model="name"
         class="w-full mb-3 p-2 border rounded"
         placeholder="Nama Lengkap">

  <input x-model="orcid"
         class="w-full mb-4 p-2 border rounded"
         placeholder="ORCID (opsional, sangat disarankan)">

  <button @click="analyze()"
          class="w-full bg-blue-600 text-white p-2 rounded">
    Analisis Karier Saya
  </button>

  <div x-show="loading" class="mt-4 text-blue-600">
    Mengambil data publikasi...
  </div>

  <!-- HASIL PUBLIKASI -->
  <template x-for="p in publications" :key="p.title">
    <div class="border-b py-2 mt-3">
      <strong x-text="p.title"></strong>
      <div class="text-sm text-gray-500"
           x-text="p.year"></div>
    </div>
  </template>

  <!-- RINGKASAN -->
  <div x-show="publications.length" class="mt-6">
    <h3 class="font-bold mb-2">Ringkasan</h3>
    <p>Total Publikasi: <strong x-text="publications.length"></strong></p>
    <p class="mt-2 text-blue-600 font-bold">
      Level Karier Saat Ini: <span x-text="level"></span>
    </p>
  </div>

</div>

<script>
function careerApp(){
  return{
    name:'',
    orcid:'',
    publications:[],
    loading:false,
    level:'',

    async analyze(){
      this.loading=true;
      this.publications=[];
      this.level='';

      if(this.orcid){
        await this.fetchFromORCID();
      }else{
        await this.fetchFromOpenAlex();
      }

      this.loading=false;
    },

    calculateLevel(){
      const n = this.publications.length;
      if(n < 3) this.level = 'Asisten Ahli';
      else if(n < 7) this.level = 'Lektor';
      else if(n < 15) this.level = 'Lektor Kepala';
      else this.level = 'Menuju Profesor';
    },

    async fetchFromORCID(){
      try{
        const res = await fetch(`https://pub.orcid.org/v3.0/${this.orcid}/works`,{
          headers:{'Accept':'application/json'}
        });
        const data = await res.json();

        this.publications = data.group.map(g=>({
          title: g['work-summary'][0].title.title.value,
          year: g['work-summary'][0]['publication-date']?.year?.value || ''
        }));

        this.calculateLevel();
      }catch(e){
        alert('Gagal mengambil data ORCID.');
      }
    },

    async fetchFromOpenAlex(){
      if(!this.name){
        alert('Masukkan nama atau ORCID.');
        return;
      }

      try{
        const url = `https://api.openalex.org/works?filter=authorships.author.display_name.search:${encodeURIComponent(this.name)}&per-page=20`;
        const res = await fetch(url);
        const data = await res.json();

        this.publications = data.results.map(w=>({
          title:w.title,
          year:w.publication_year
        }));

        this.calculateLevel();
      }catch(e){
        alert('Gagal mengambil data OpenAlex.');
      }
    }
  }
}
</script>

</body>
</html>
